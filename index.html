<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8">
  <title>heeh.ee</title>

  <style>
    body {
      margin: 0;
      height: 100vh;
      background: black;
      overflow: hidden;
    }

    #dance {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 65vw;
      max-height: 80vh;
      object-fit: contain;
      transition: transform 0.14s ease-out;
      cursor: pointer;
    }

    .hint {
      position: fixed;
      right: 12px;
      bottom: 12px;
      color: white;
      opacity: 0.6;
      font-family: Arial, sans-serif;
      font-size: 12px;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <img id="dance" src="hehe-dance.gif" alt="dance">
  <div class="hint">ðŸ”Š sound on interaction</div>

  <audio id="music" loop muted>
    <source src="billijean.mp3" type="audio/mpeg">
  </audio>

  <script>
    const music = document.getElementById("music");
    const gif = document.getElementById("dance");
    const hint = document.querySelector(".hint");

    // === AUDIO / BPM ===
    const BPM = 117;
    const beatInterval = 60000 / BPM;

    // === SCALE LOGIC ===
    const minScale = 1.0;
    const maxScale = 1.35;
    const crescendoSteps = 6;

    let scale = minScale;
    let step = 0;
    let direction = 1;
    let beatCount = 0;

    setInterval(() => {
      beatCount++;

      // STEP SCALE UP / DOWN
      const stepSize = (maxScale - minScale) / crescendoSteps;
      scale += stepSize * direction;
      step++;

      if (step >= crescendoSteps) {
        direction *= -1;
        step = 0;
      }

      // === MEGAZOOM EVERY 9TH BEAT ===
      if (beatCount % 9 === 0) {
        gif.style.transform = "scale(1.7)";
        setTimeout(() => {
          gif.style.transform = `scale(${scale})`;
        }, 140);
      } else {
        gif.style.transform = `scale(${scale})`;
      }

    }, beatInterval);

    // === ENABLE SOUND ON ANY INTERACTION ===
    let soundEnabled = false;

    function enableSound() {
      if (soundEnabled) return;
      soundEnabled = true;

      music.play().catch(() => {});
      music.muted = false;
      music.volume = 0;

      const fadeDuration = 2000;
      const stepTime = 50;
      const steps = fadeDuration / stepTime;
      let s = 0;

      const fade = setInterval(() => {
        s++;
        music.volume = Math.min(s / steps, 1);
        if (music.volume >= 1) clearInterval(fade);
      }, stepTime);

      if (hint) hint.remove();

      ["click","mousemove","scroll","keydown","touchstart"].forEach(e =>
        window.removeEventListener(e, enableSound)
      );
    }

    ["click","mousemove","scroll","keydown","touchstart"].forEach(e =>
      window.addEventListener(e, enableSound)
    );

    gif.addEventListener("click", enableSound);
  </script>
</body>
</html>
<!-- redeploy -->
