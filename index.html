<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<title>heeh.ee</title>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

/* n√§htamatu audio unlock */
#unlock {
  position: fixed;
  inset: 0;
  z-index: 9999;
}

/* gif */
#gif {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 120px;
  transform-origin: bottom left;
  transform: scale(0.15);
  transition: transform 0.08s linear;
}
</style>
</head>

<body>

<div id="unlock"></div>
<img id="gif" src="hehe-dance.gif">

<script>
/* =====================
   STATE
===================== */
let audio, ctx, analyser, data;
let started = false;
let energyHistory = [];
let lastMega = 0;

/* =====================
   ELEMENTS
===================== */
const gif = document.getElementById("gif");
const unlock = document.getElementById("unlock");

/* =====================
   START (AINUS LUBATUD)
===================== */
unlock.addEventListener("pointerdown", () => {
  if (started) return;
  started = true;
  unlock.remove();

  audio = new Audio("billijean.mp3");
  audio.loop = true;

  ctx = new AudioContext();
  analyser = ctx.createAnalyser();
  analyser.fftSize = 256;

  const source = ctx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(ctx.destination);

  data = new Uint8Array(analyser.frequencyBinCount);

  audio.play();
  requestAnimationFrame(loop);
});

/* =====================
   ANALYSIS LOOP
===================== */
function loop() {
  analyser.getByteFrequencyData(data);

  // bass = alumised sagedused
  let bass = 0;
  for (let i = 0; i < 10; i++) bass += data[i];
  bass /= 10;

  // √ºldenergia
  let energy = data.reduce((a,b) => a+b, 0) / data.length;

  energyHistory.push(energy);
  if (energyHistory.length > 60) energyHistory.shift();

  const avgEnergy =
    energyHistory.reduce((a,b) => a+b, 0) / energyHistory.length;

  // pingelisus = bass + keskmine energia
  const tension = Math.min(1, (bass + energy) / 300);

  // normaalne pulse
  let scale = 0.3 + tension * 2.2;

  // üí• MEGAZOOM kui bass spike
  const now = performance.now();
  if (bass > avgEnergy * 1.8 && now - lastMega > 1200) {
    scale = 6;
    lastMega = now;
  }

  gif.style.transform = `scale(${scale})`;

  requestAnimationFrame(loop);
}
</script>

</body>
</html>
