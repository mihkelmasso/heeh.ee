<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8">
  <title>heeh.ee</title>

  <style>
    body {
      margin: 0;
      height: 100vh;
      background: black;
      overflow: hidden;
    }

    #dance {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 65vw;
      max-height: 80vh;
      object-fit: contain;
      transition: transform 0.12s ease-out;
      cursor: pointer;
    }

    .hint {
      position: fixed;
      right: 12px;
      bottom: 12px;
      color: white;
      opacity: 0.6;
      font-family: Arial, sans-serif;
      font-size: 12px;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <img id="dance" src="hehe-dance.gif" alt="dance">
  <div class="hint">ðŸ”Š sound on interaction</div>

  <audio id="music" loop muted>
    <source src="billijean.mp3" type="audio/mpeg">
  </audio>

  <script>
    const music = document.getElementById("music");
    const gif = document.getElementById("dance");
    const hint = document.querySelector(".hint");

    // Billie Jean BPM
    const BPM = 117;
    const beatInterval = 60000 / BPM;

    // SCALE SETTINGS
    const minScale = 1.0;
    const maxScale = 1.35;
    const steps = 6; // mitu biiti Ã¼les / alla

    let currentStep = 0;
    let direction = 1; // 1 = kasvab, -1 = kahaneb
    let scale = minScale;

    // BEAT LOOP
    setInterval(() => {
      const stepSize = (maxScale - minScale) / steps;

      scale += stepSize * direction;
      currentStep++;

      if (currentStep >= steps) {
        direction *= -1;     // vaheta suunda
        currentStep = 0;
      }

      gif.style.transform = `scale(${scale})`;
    }, beatInterval);

    // SOUND ENABLE (any interaction)
    let soundEnabled = false;

    function enableSound() {
      if (soundEnabled) return;
      soundEnabled = true;

      music.play().catch(() => {});
      music.muted = false;
      music.volume = 0;

      const fadeDuration = 2000;
      const stepTime = 50;
      const steps = fadeDuration / stepTime;
      let step = 0;

      const fade = setInterval(() => {
        step++;
        music.volume = Math.min(step / steps, 1);
        if (music.volume >= 1) clearInterval(fade);
      }, stepTime);

      if (hint) hint.remove();

      ["click","mousemove","scroll","keydown","touchstart"].forEach(e =>
        window.removeEventListener(e, enableSound)
      );
    }

    ["click","mousemove","scroll","keydown","touchstart"].forEach(e =>
      window.addEventListener(e, enableSound)
    );

    gif.addEventListener("click", enableSound);
  </script>
</body>
</html>
